<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>욕창 발생 확률 계산기</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="text-center">욕창 발생 확률 예측</h2>
    <form id="prediction-form" class="p-4 bg-white shadow rounded">
        <div class="mb-3">
            <label class="form-label">의식수준 (RASS -5 ~ +4)</label>
            <input type="number" step="0.1" name="feature1" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">실금횟수</label>
            <input type="number" step="0.1" name="feature2" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">하지근력(0 ~ 10)</label>
            <input type="number" step="0.1" name="feature3" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">체온</label>
            <input type="number" step="0.1" name="feature4" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">예측하기</button>
    </form>

    <div id="result" class="mt-4 p-4 bg-white shadow rounded d-none">
        <h4>예측 결과</h4>
        <p><strong>욕창 발생 확률:</strong> <span id="probability"></span>%</p>
        <h5>주요 기여 요인:</h5>
        <ul id="shap-values"></ul>
    </div>
</div>

<script>
    document.getElementById("prediction-form").addEventListener("submit", function(event) {
        event.preventDefault();
        
        let formData = new FormData(this);
        
        fetch("/predict", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert("오류 발생: " + data.error);
                return;
            }
            
            document.getElementById("probability").innerText = data.probability;
            let shapList = document.getElementById("shap-values");
            shapList.innerHTML = "";

            data.shap_values.forEach(item => {
                let li = document.createElement("li");
                li.innerText = `${item.Feature}: ${item["SHAP Value"]}% 기여`;
                shapList.appendChild(li);
            });

            document.getElementById("result").classList.remove("d-none");
        })
        .catch(error => console.error("Error:", error));
    });
</script>

</body>
</html>
